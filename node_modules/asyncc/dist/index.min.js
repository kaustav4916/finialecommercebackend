!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.asyncc={})}(this,function(t){"use strict";function n(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),function(n,e){function i(n,s){var o=t[r++];n||!o?e&&e(n,s):o(s,i)}var r=0;i(null,n)}}function e(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),function(n,e){function i(n,s){var o=t[r++];try{if(n){for(;o&&3!==o.length;)o=t[r++];o&&o(n,s,i)}else{for(;o&&o.length>2;)o=t[r++];o&&o(s,i)}}catch(t){i(t,s)}o||e&&e(n,s)}var r=0;i(null,n)}}function i(t,n,e){function i(t,i){t||n(s)?e&&e(t,i):w(function(){r()})}function r(){t(i,s++)}var s=0;r()}function r(t,n,e){i(t,function(t){return!n(t)},e)}function s(t,n,e,i,r){function s(t){if(!l++){var n=null;(u.length||t)&&(n=new j(t||"err",c,u)),r(n,f)}}function o(t,l,p){if(f[t]=p,c[t]=l,l&&(u.push(t),i.bail))return void s("err_bail");a--,h<n?e(h++,o):r&&!a&&s()}void 0===i&&(i={}),"function"==typeof i&&(r=i,i={}),t=Math.abs(t||n);var u=[],c=new Array(n).fill(),f=new Array(n).fill(),h=0,a=n,l=0;if(0===a)return void s();for(i.timeout&&setTimeout(function(){a&&s("err_timeout")},i.timeout),t=t<n?t:n;h<t;)e(h++,o)}function o(t,n,e,i,r){function o(t,i){e(n[t],function(n,e){i(t,n,e)},t)}s(t,n.length,o,i,r)}function u(t,n,e,i){o(0,t,n,e,i)}function c(t,n,e){function i(t,n){o.push(n),t||s===u?e&&e(t,o):u<s&&w(function(){r()})}function r(){n(t[u],i,u++)}var s=t.length,o=[],u=0;if(0===s)return void e(null,[]);r()}function f(t){this._tasks=[],this.result=t,this.error=void 0,this._lock=!1}function h(t){return new f(t)}function a(t,n,e,i){function r(t,e){n[t](function(n,i){e(t,n,i)})}s(t,n.length,r,e,i)}function l(t,n,e){a(0,t,n,e)}function p(){this.reset()}function _(t,n){this._task=t,this._concurrency=Math.abs(n||1),this._worker=0,this._paused=!1,this._items=new p}function m(t,n){return new _(t,n)}function d(t,n){n=n||{};var e=w,i=0,r=t;return"number"!=typeof t&&(r=t.times,i=t.lag||0),r=r||n.times||0,i&&(e=setTimeout),{times:r,lag:i,fn:e}}function y(t,n,e){function i(t,n){!t||s>=u?e&&e(t,n):f(function(){r()},c)}function r(){n(i,s++)}var s=0,o=d(t,{times:2}),u=o.times,c=o.lag,f=o.fn;r()}function v(t,n){function e(){t[o++](i)}function i(t,i){s.push(i),t||r===o?n&&n(t,s):o<r&&w(function(){e()})}var r=t.length,s=[],o=0;if(0===r)return void n(null,[]);e()}function g(t,n,e){function i(t,n){t||u>0&&s>=u?e&&e(t,n):f(function(){r()},c)}function r(){n(i,s++)}var s=0,o=d(t),u=o.times,c=o.lag,f=o.fn;u?r():e&&e()}function k(t,n,e){function i(n,i){n||t(s)?e&&e(n,i):w(function(){r()})}function r(){n(i,s++)}var s=0;t(s)?e&&e():r()}function b(t,n,e){k(function(n){return!t(n)},n,e)}var w=function(){return"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(t){setTimeout(t,0)}}(),j=function(t){function n(n,e,i){t.call(this,n),Object.assign(this,{name:"AsynccError",message:n,errors:e,errpos:i,stack:this.stack||(new t).stack})}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n}(Error);f.prototype={_run:function(){var t=this;if(!this._lock){this._lock=!0;for(var n=this._tasks.shift(),e=this.error?["catch","end"]:["then","end"];n&&!~e.indexOf(n.type);)n=t._tasks.shift();if(n){var i=function(n,e){t.error=n,t.result=e||t.result,t._lock=!1,t._run()},r=n.fn;if("end"===n.type)r(this.error,this.result);else try{"catch"===n.type?r(this.error,this.result,i):r(this.result,i)}catch(t){i(t)}}else this._lock=!1}},then:function(t){return this._tasks.push({type:"then",fn:t}),this._run(),this},catch:function(t){return this._tasks.push({type:"catch",fn:t}),this._run(),this},end:function(t){this._tasks.push({type:"end",fn:t}),this._run()}},p.prototype={get length(){return this.items.length},shift:function(){return(this.items.shift()||{}).item},push:function(t,n){var e=this.items;if("number"!=typeof n)n=1/0,e.push({prio:n,item:t});else{var i;n=Math.abs(n);for(var r=0;r<e.length;r++)if(n<e[r].prio){e.splice(r,0,{prio:n,item:t}),i=!0;break}i||e.push({prio:n,item:t})}return this},unshift:function(t){return this.items.unshift({prio:0,item:t}),this},reset:function(){this.items=[]}},_.prototype={_run:function(){var t=this,n=this,e=n._items,i=n._drain;if(this._worker-=1,0===e.length)this._worker<=0&&(this._worker=0,i&&i());else{this._worker+=1;var r=e.shift(),s=r[0],o=r[1];this._task(s,function(n,e){o&&o(n,e),w(function(){t._run()})})}},_start:function(){for(var t=this;!this._paused&&this._worker<Math.min(this._concurrency,this._items.length);)t._worker+=1,t._run();return this},get paused(){return this._paused},get idle(){return!this.length&&0===this._worker},get length(){return this._items.length},pause:function(){return this._paused=!0,this},resume:function(){return this._paused=!1,this._start()},reset:function(){return this._items.reset(),this},running:function(){return this._worker},push:function(t,n,e){return this.concat([t],n,e)},concat:function(t,n,e){var i=this;return"number"==typeof n&&(e=n,n=void 0),t.forEach(function(t){i._items.push([t,n],e)}),this._start()},unshift:function(t,n){return this._items.unshift([t,n]),this._start()},drain:function(t){return this._drain=t,this}};var A={_setImmediate:w,AsynccError:j,compose:n,connect:e,doUntil:i,doWhilst:r,each:u,eachLimit:o,eachSeries:c,noPromise:h,NoPromise:f,parallel:l,parallelLimit:a,queue:m,Queue:_,retry:y,series:v,times:g,until:k,whilst:b};t.default=A,t._setImmediate=w,t.AsynccError=j,t.compose=n,t.connect=e,t.doUntil=i,t.doWhilst=r,t.each=u,t.eachLimit=o,t.eachSeries=c,t.noPromise=h,t.NoPromise=f,t.parallel=l,t.parallelLimit=a,t.queue=m,t.Queue=_,t.retry=y,t.series=v,t.times=g,t.until=k,t.whilst=b,Object.defineProperty(t,"__esModule",{value:!0})});